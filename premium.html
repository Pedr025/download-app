<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover, user-scalable=no, maximum-scale=1.0">
    <meta name="apple-mobile-web-app-capable" content="true">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>Watch Party Pro - Premium</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
    
    <!-- Firebase SDKs -->
    <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-database-compat.js"></script>

    <!-- Mercado Pago SDK -->
    <script src="https://sdk.mercadopago.com/js/v2"></script>

    <style>
        :root { 
            --accent: #0072d2;
            --accent-light: #00a8ff;
            --bg-dark: rgba(4, 7, 20, 0.7);
            --bg-darker: #020409;
            --text-main: #f9f9f9;
            --text-secondary: #b3b3b3;
            --border-color: rgba(255, 255, 255, 0.1);
            --premium-gold: #ffcc00;
        }
        
        * { box-sizing: border-box; margin: 0; padding: 0; -webkit-user-select: none; user-select: none; -webkit-tap-highlight-color: transparent; }
        html { width: 100%; height: 100%; }
        body { width: 100%; height: 100vh; height: 100dvh; background-color: #000; overflow: hidden; font-family: 'Avenir Next', 'Segoe UI', Roboto, Helvetica, Arial, sans-serif; -webkit-font-smoothing: antialiased; display: flex; justify-content: center; align-items: center; }

        .premium-container {
            background: var(--bg-darker);
            border-radius: 24px;
            padding: 30px;
            text-align: center;
            border: 1px solid var(--border-color);
            max-width: 450px;
            width: 90%;
            color: var(--text-main);
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
        }

        .premium-container h1 {
            color: var(--premium-gold);
            font-size: 28px;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }

        .premium-container p {
            color: var(--text-secondary);
            font-size: 15px;
            margin-bottom: 30px;
            line-height: 1.6;
        }

        .plan-card {
            background: rgba(255,255,255,0.05);
            border: 1px solid var(--border-color);
            border-radius: 16px;
            padding: 20px;
            margin-bottom: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: left;
        }

        .plan-card:hover {
            border-color: var(--accent);
            transform: translateY(-5px);
            box-shadow: 0 5px 20px rgba(0,114,210,0.2);
        }

        .plan-card.selected {
            border-color: var(--premium-gold);
            box-shadow: 0 5px 20px rgba(255,204,0,0.2);
        }

        .plan-card h2 {
            font-size: 22px;
            color: var(--text-main);
            margin-bottom: 10px;
        }

        .plan-card .price {
            font-size: 32px;
            font-weight: bold;
            color: var(--premium-gold);
            margin-bottom: 10px;
        }

        .plan-card .price span {
            font-size: 16px;
            color: var(--text-secondary);
            font-weight: normal;
        }

        .plan-card ul {
            list-style: none;
            padding: 0;
            margin-bottom: 20px;
        }

        .plan-card ul li {
            display: flex;
            align-items: center;
            gap: 10px;
            color: var(--text-secondary);
            font-size: 14px;
            margin-bottom: 8px;
        }

        .plan-card ul li i {
            color: var(--accent);
        }

        .buy-button {
            background: var(--premium-gold);
            color: #000;
            border: none;
            padding: 15px 30px;
            border-radius: 50px;
            font-size: 18px;
            font-weight: bold;
            cursor: pointer;
            width: 100%;
            transition: background 0.3s ease;
        }

        .buy-button:hover {
            background: #e6b800;
        }

        .loading-overlay {
            position: fixed; top: 0; left: 0; right: 0; bottom: 0;
            background: rgba(0,0,0,0.8); display: flex; justify-content: center; align-items: center;
            z-index: 9999; color: white; font-size: 20px; flex-direction: column; gap: 20px;
            display: none; /* Hidden by default */
        }

        .loading-overlay.active { display: flex; }

        .spinner {
            border: 4px solid rgba(255,255,255,0.3);
            border-top: 4px solid var(--premium-gold);
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .back-button {
            background: none;
            border: none;
            color: var(--text-secondary);
            font-size: 14px;
            margin-top: 20px;
            cursor: pointer;
            transition: color 0.3s ease;
        }

        .back-button:hover {
            color: var(--accent-light);
        }

    </style>
</head>
<body>
    <div class="premium-container">
        <h1><i class="fas fa-crown"></i> Torne-se Premium</h1>
        <p>Desbloqueie recursos exclusivos, remova anúncios e tenha uma experiência completa na Watch Party Pro!</p>

        <div class="plan-card" data-plan-id="monthly" data-price="9.99">
            <h2>Plano Mensal</h2>
            <div class="price">R$9,99 <span>/ mês</span></div>
            <ul>
                <li><i class="fas fa-check-circle"></i> Sem anúncios</li>
                <li><i class="fas fa-check-circle"></i> Chat ilimitado</li>
                <li><i class="fas fa-check-circle"></i> Criar enquetes</li>
                <li><i class="fas fa-check-circle"></i> Suporte prioritário</li>
            </ul>
            <button class="buy-button">Assinar Mensal</button>
        </div>

        <div class="plan-card" data-plan-id="annual" data-price="99.99">
            <h2>Plano Anual</h2>
            <div class="price">R$99,99 <span>/ ano</span></div>
            <ul>
                <li><i class="fas fa-check-circle"></i> Sem anúncios</li>
                <li><i class="fas fa-check-circle"></i> Chat ilimitado</li>
                <li><i class="fas fa-check-circle"></i> Criar enquetes</li>
                <li><i class="fas fa-check-circle"></i> Suporte prioritário</li>
                <li><i class="fas fa-gift"></i> 2 meses grátis!</li>
            </ul>
            <button class="buy-button">Assinar Anual</button>
        </div>

        <button class="back-button" onclick="window.history.back();">Voltar</button>
    </div>

    <div class="loading-overlay" id="loading-overlay">
        <div class="spinner"></div>
        <p>Redirecionando para o pagamento...</p>
    </div>

    <script>
        // CONFIGURAÇÃO FIREBASE (Copiar do arquivo watchparty_admin_controls.html)
        const firebaseConfig = {
            apiKey: "AIzaSyB0IJNOMSnpHEazCNA7Nu02gsbAUNvmIYE",
            authDomain: "nupmatch---filmes-com-amigos.firebaseapp.com",
            databaseURL: "https://nupmatch---filmes-com-amigos-default-rtdb.firebaseio.com",
            projectId: "nupmatch---filmes-com-amigos",
            storageBucket: "nupmatch---filmes-com-amigos.firebasestorage.app",
            messagingSenderId: "635179962057",
            appId: "1:635179962057:android:74e392a19328c77d450718"
        };

        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.database();

        let currentUser = null;

        auth.onAuthStateChanged(user => {
            if (user) {
                currentUser = user;
                console.log("Usuário logado:", currentUser.uid);
            } else {
                // Redirecionar para a página de login ou mostrar modal
                alert("Você precisa estar logado para assinar o Premium.");
                window.location.href = "/"; // Ou a página de login
            }
        });

        // Inicializar Mercado Pago SDK
        const mp = new MercadoPago("TEST-228a900e-e703-4409-96c9-d74f4c5e44ef", {
            locale: "pt-BR"
        });

        document.querySelectorAll('.plan-card').forEach(card => {
            card.addEventListener('click', () => {
                document.querySelectorAll('.plan-card').forEach(c => c.classList.remove('selected'));
                card.classList.add('selected');
            });
        });

        document.querySelectorAll('.buy-button').forEach(button => {
            button.addEventListener('click', async (event) => {
                event.stopPropagation(); // Evita que o clique no botão selecione o card novamente
                const selectedPlanCard = event.target.closest('.plan-card');
                if (!selectedPlanCard) return;

                const planId = selectedPlanCard.dataset.planId;
                const price = selectedPlanCard.dataset.price;
                const description = selectedPlanCard.querySelector('h2').innerText;

                if (!currentUser) {
                    alert("Por favor, faça login para continuar.");
                    return;
                }

                document.getElementById('loading-overlay').classList.add('active');

                try {
                    // Criar preferência de pagamento no backend
                    // Substitua esta URL pela URL do seu endpoint de backend
                    const response = await fetch('YOUR_BACKEND_CREATE_PREFERENCE_ENDPOINT', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({
                            userId: currentUser.uid,
                            userName: currentUser.displayName,
                            userEmail: currentUser.email,
                            planId: planId,
                            price: parseFloat(price),
                            description: description
                        }),
                    });

                    const preference = await response.json();

                    if (preference.id) {
                        // Redirecionar para o checkout do Mercado Pago
                        mp.checkout({
                            preference: { id: preference.id },
                            render: {
                                container: '.buy-button', // Não será usado para redirecionamento
                                label: 'Pagar',
                            }
                        }).open();
                    } else {
                        alert('Erro ao criar preferência de pagamento. Tente novamente.');
                        document.getElementById('loading-overlay').classList.remove('active');
                    }
                } catch (error) {
                    console.error('Erro ao iniciar pagamento:', error);
                    alert('Erro ao iniciar pagamento. Verifique sua conexão e tente novamente.');
                    document.getElementById('loading-overlay').classList.remove('active');
                }
            });
        });

    </script>
</body>
</html>
