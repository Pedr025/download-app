<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Premium - PKFilmes</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        :root {
            --bg: #040714;
            --accent: #E50914; /* Vermelho Netflix */
            --accent-glow: rgba(229, 9, 20, 0.5);
            --text-main: #f9f9f9;
            --text-gray: #a3a3a3;
            --card-bg: rgba(255, 255, 255, 0.05);
            --card-border: rgba(255, 255, 255, 0.1);
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            background-color: var(--bg);
            color: var(--text-main);
            font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            overflow-x: hidden;
        }

        /* Background Glow Effect */
        body::before {
            content: '';
            position: fixed;
            top: -10%;
            left: -10%;
            width: 120%;
            height: 120%;
            background: radial-gradient(circle at 50% 0%, #1a1d29 0%, var(--bg) 70%);
            z-index: -1;
        }

        header {
            width: 100%;
            padding: 20px 4%;
            background: linear-gradient(to bottom, rgba(0,0,0,0.8) 0%, transparent 100%);
            position: fixed;
            top: 0;
            z-index: 100;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo {
            font-size: 28px;
            font-weight: 900;
            color: var(--accent);
            letter-spacing: -1px;
            text-decoration: none;
        }

        .logo span {
            color: #fff;
        }

        .container {
            width: 100%;
            max-width: 1000px;
            margin-top: 100px;
            padding: 40px 20px;
            text-align: center;
            flex: 1;
        }

        .hero-section {
            margin-bottom: 50px;
            animation: fadeInDown 0.8s ease-out;
        }

        @keyframes fadeInDown {
            from { opacity: 0; transform: translateY(-20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .premium-badge {
            display: inline-block;
            background: linear-gradient(45deg, #E50914, #ff4d4d);
            color: white;
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: bold;
            text-transform: uppercase;
            margin-bottom: 15px;
            box-shadow: 0 0 15px var(--accent-glow);
        }

        h1 {
            font-size: clamp(32px, 8vw, 56px);
            font-weight: 800;
            line-height: 1.1;
            margin-bottom: 20px;
            background: linear-gradient(to bottom, #fff 60%, #ccc);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .subtitle {
            font-size: 18px;
            color: var(--text-gray);
            max-width: 600px;
            margin: 0 auto 40px;
        }

        /* Features Grid */
        .features-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            margin-bottom: 60px;
        }

        .feature-card {
            background: var(--card-bg);
            border: 1px solid var(--card-border);
            border-radius: 16px;
            padding: 30px;
            text-align: left;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
        }

        .feature-card:hover {
            transform: translateY(-5px);
            background: rgba(255, 255, 255, 0.08);
            border-color: rgba(229, 9, 20, 0.3);
        }

        .feature-card i {
            font-size: 28px;
            color: var(--accent);
            margin-bottom: 20px;
            display: block;
        }

        .feature-card h3 {
            font-size: 20px;
            margin-bottom: 10px;
            color: #fff;
        }

        .feature-card p {
            font-size: 14px;
            color: var(--text-gray);
            line-height: 1.5;
        }

        /* Pricing Section */
        .pricing-container {
            background: linear-gradient(145deg, rgba(255,255,255,0.05) 0%, rgba(255,255,255,0.02) 100%);
            border: 1px solid var(--card-border);
            border-radius: 24px;
            padding: 40px;
            max-width: 500px;
            margin: 0 auto;
            position: relative;
            box-shadow: 0 20px 40px rgba(0,0,0,0.4);
        }

        .price-tag {
            margin-bottom: 30px;
        }

        .price-amount {
            font-size: 64px;
            font-weight: 800;
            color: #fff;
        }

        .price-currency {
            font-size: 24px;
            vertical-align: super;
            margin-right: 5px;
        }

        .price-period {
            font-size: 18px;
            color: var(--text-gray);
        }

        /* Mercado Pago Button Style */
        #walletBrick_container {
            width: 100%;
            margin-top: 20px;
        }

        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: var(--bg);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            display: none;
        }

        .spinner {
            width: 50px;
            height: 50px;
            border: 3px solid rgba(229, 9, 20, 0.2);
            border-top: 3px solid var(--accent);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-bottom: 20px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Success Message */
        #success-message {
            display: none;
            padding: 40px;
            background: #000;
            border-radius: 20px;
            border: 1px solid #00ff00;
            margin-top: 20px;
        }

        .success-icon {
            font-size: 60px;
            color: #00ff00;
            margin-bottom: 20px;
        }

        @media (max-width: 600px) {
            h1 { font-size: 40px; }
            .pricing-container { padding: 30px 20px; }
        }
    </style>
</head>
<body>

    <div class="loading-overlay" id="loading">
        <div class="spinner"></div>
        <p id="loading-text">Processando seu pagamento...</p>
    </div>

    <header>
        <a href="index.html" class="logo">PK<span>FILMES</span></a>
    </header>

    <div class="container">
        <div class="hero-section">
            <div class="premium-badge">Assinatura Anual</div>
            <h1>Suba de nível com o Premium.</h1>
            <p class="subtitle">Tenha acesso a recursos exclusivos, sem anúncios e suporte prioritário na maior plataforma de streaming independente.</p>
        </div>

        <div class="features-grid">
            <div class="feature-card">
                <i class="fa-solid fa-rectangle-ad"></i>
                <h3>Sem Anúncios</h3>
                <p>Assista seus filmes e séries favoritos sem interrupções. Zero propagandas.</p>
            </div>
            <div class="feature-card">
                <i class="fa-solid fa-id-badge"></i>
                <h3>Moldura Exclusiva</h3>
                <p>Destaque seu perfil na comunidade com molduras animadas e raras.</p>
            </div>
            <div class="feature-card">
                <i class="fa-solid fa-circle-check"></i>
                <h3>Perfil Verificado</h3>
                <p>Ganhe o selo azul de autenticidade e seja reconhecido em todo o site.</p>
            </div>
            <div class="feature-card">
                <i class="fa-solid fa-star"></i>
                <h3>Conteúdos VIP</h3>
                <p>Acesso antecipado a lançamentos e categorias exclusivas para assinantes.</p>
            </div>
            <div class="feature-card">
                <i class="fa-solid fa-wand-magic-sparkles"></i>
                <h3>Pedidos Ilimitados</h3>
                <p>Peça qualquer filme ou série sem limites diários. Nós buscamos para você.</p>
            </div>
            <div class="feature-card">
                <i class="fa-solid fa-bolt"></i>
                <h3>Suporte 24/7</h3>
                <p>Prioridade total no atendimento e resoluções rápidas de problemas.</p>
            </div>
        </div>

        <div class="pricing-container" id="payment-section">
            <div class="price-tag">
                <span class="price-currency">R$</span>
                <span class="price-amount">10</span>
                <span class="price-period">/ 30 dias</span>
            </div>
            <p style="margin-bottom: 25px; color: var(--text-gray); font-size: 14px;">
                Pagamento seguro processado pelo Mercado Pago.
            </p>
            
            <div id="walletBrick_container"></div>
        </div>

        <div id="success-message">
            <i class="fa-solid fa-circle-check success-icon"></i>
            <h2>Pagamento Confirmado!</h2>
            <p style="margin: 20px 0; color: var(--text-gray);">Seu perfil agora é Premium. Aproveite todas as vantagens!</p>
            <button onclick="window.location.href='index.html'" style="background: var(--accent); color: white; border: none; padding: 15px 30px; border-radius: 8px; font-weight: bold; cursor: pointer;">
                VOLTAR AO INÍCIO
            </button>
        </div>
    </div>

    <!-- Firebase & SDKs -->
    <script src="https://sdk.mercadopago.com/js/v2"></script>
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
        import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-auth.js";
        import { getDatabase, ref, update, get } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-database.js";

        // Firebase Config (Mesma do seu profile.html)
        const firebaseConfig = {
            apiKey: "AIzaSyBIQSqbbN-adfJjONc0pmTY4PZahwk6a6w",
            authDomain: "nupcine.firebaseapp.com",
            databaseURL: "https://nupcine-default-rtdb.firebaseio.com",
            projectId: "nupcine",
            storageBucket: "nupcine.appspot.com",
            messagingSenderId: "602295443044",
            appId: "1:602295443044:web:af618627a1dbe5b142c971",
            measurementId: "G-YD3TPSJTCF"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getDatabase(app);
        
        let currentUser = null;

        // Mercado Pago Config
        const mp = new MercadoPago('APP_USR-78601639-6504-4690-8488-877203598585'); // Substitua pela sua PUBLIC_KEY
        const bricksBuilder = mp.bricks();

        onAuthStateChanged(auth, async (user) => {
            if (user) {
                currentUser = user;
                checkPaymentStatus();
            } else {
                // Se não estiver logado, redireciona ou mostra erro
                console.log("Usuário não logado");
            }
        });

        async function checkPaymentStatus() {
            const urlParams = new URLSearchParams(window.location.search);
            const status = urlParams.get('status');
            const paymentId = urlParams.get('payment_id');

            if (status === 'approved' && currentUser) {
                showLoading("Ativando seu Premium...");
                try {
                    // Atualiza no Firebase
                    await update(ref(db, 'users/' + currentUser.uid), {
                        Premium: "on",
                        verificado: true,
                        premiumUntil: new Date(Date.now() + 30 * 24 * 60 * 60 * 1000).toISOString()
                    });
                    
                    hideLoading();
                    document.getElementById('payment-section').style.display = 'none';
                    document.getElementById('success-message').style.display = 'block';
                } catch (e) {
                    alert("Erro ao ativar premium: " + e.message);
                    hideLoading();
                }
            } else {
                renderPaymentButton();
            }
        }

        async function renderPaymentButton() {
            if (!currentUser) return;

            try {
                // Chamada ao seu backend para criar a preferência de pagamento
                // Substitua pela URL do seu servidor (ex: Heroku, Vercel, ou seu próprio domínio)
                const response = await fetch('https://seu-backend-aqui.com/create_preference', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ 
                        email: currentUser.email, 
                        userId: currentUser.uid 
                    })
                });
                
                const data = await response.json();
                const preferenceId = data.id;

                if (!preferenceId) throw new Error("Não foi possível gerar o ID de pagamento.");

                bricksBuilder.create("wallet", "walletBrick_container", {
                    initialization: {
                        preferenceId: preferenceId,
                    },
                    customization: {
                        texts: {
                            valueProp: 'smart_option',
                        },
                    },
                    callbacks: {
                        onReady: () => {
                            console.log("Brick pronto");
                        },
                        onSubmit: () => {
                            showLoading("Iniciando checkout...");
                        },
                        onError: (error) => {
                            console.error(error);
                        },
                    },
                });
            } catch (error) {
                console.error("Erro ao carregar botão de pagamento:", error);
            }
        }

        function showLoading(text) {
            document.getElementById('loading').style.display = 'flex';
            document.getElementById('loading-text').innerText = text;
        }

        function hideLoading() {
            document.getElementById('loading').style.display = 'none';
        }
    </script>
</body>
</html>
