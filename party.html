<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Party - FilmesRave</title>
</head>
<body>

<h2>Sala: <span id="room"></span></h2>

<video id="video" controls width="100%"></video>

<div id="chat"></div>

<input id="msg">
<button onclick="send()">Enviar</button>

<script>

const params = new URLSearchParams(location.search)

let room = params.get("room")

if (!room) {

room = crypto.randomUUID()

location.href =
"/party.html?room=" + room

}

document.getElementById("room").innerText = room

const ws = new WebSocket(
"wss://party.filmesrave.com/" + room
)

const video =
document.getElementById("video")

ws.onmessage = (event) => {

const data =
JSON.parse(event.data)

if (data.type === "chat") {

document.getElementById("chat")
.innerHTML +=
"<p>" + data.message + "</p>"

}

if (data.type === "sync") {

video.currentTime =
data.data.time

if (data.data.playing)
video.play()
else
video.pause()

}

}

function send() {

const msg =
document.getElementById("msg").value

ws.send(JSON.stringify({

type: "chat",
message: msg

}))

}

video.onplay = sync
video.onpause = sync
video.onseeked = sync

function sync() {

ws.send(JSON.stringify({

type: "sync",

data: {

playing: !video.paused,
time: video.currentTime

}

}))

}

</script>

</body>
</html>
